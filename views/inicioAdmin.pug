html
    head 
          link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous")
          script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous")
          title Alfgo 
    body
        if modal
          include modal.pug
        ul.nav.nav-tabs#myTab(role="tablist")
          li.nav-item(role="presentation")
            button.nav-link.active#home-tab(data-bs-toggle="tab", data-bs-target="#home-tab-pane", type="button", role="tab", aria-controls="home-tab-pane", aria-selected="true") Resultados de la búsqueda
          li.nav-item(role="presentation")
            button.nav-link#profile-tab(data-bs-toggle="tab", data-bs-target="#profile-tab-pane", type="button", role="tab", aria-controls="profile-tab-pane", aria-selected="false") Editar
          li.nav-item(role="presentation")
            button.nav-link#contact-tab(data-bs-toggle="tab", data-bs-target="#contact-tab-pane", type="button", role="tab", aria-controls="contact-tab-pane", aria-selected="false") Contact
          li.nav-item(role="presentation")
            button.nav-link#disabled-tab(data-bs-toggle="tab", data-bs-target="#disabled-tab-pane", type="button", role="tab", aria-controls="disabled-tab-pane", aria-selected="false", disabled) Ingresar paciente
          form(action="/pacientes/", method="get" name="formu" class="d-flex" role="search")
            input(id="searchInput" class="form-control me-2" type="search" placeholder="Search" aria-label="Search" required)
            button(class="btn btn-outline-success" type="submit") Search  
        .tab-content#myTabContent
          .tab-pane.fade.show.active#home-tab-pane(role="tabpanel", aria-labelledby="home-tab", tabindex="0")
            if ok && pacientes.length > 0
              form(action="/pacientes/:termino", method="get" name="siNo")
                  p ¿Se encuentra el paciente que busca?
                  label(for="si") Sí
                  input(type="radio", name="respuesta", value="si", id="si")
                  label(for="no") No
                  input(type="radio", name="respuesta", value="no", id="no")
              table.table.table-striped
                thead
                  tr
                    th Documento
                    th Apellido
                    th Email
                tbody
                  each paciente, index in pacientes
                    tr.fila(id=`fila-${index}`)
                      td= paciente.documento
                      td= paciente.apellido
                      td= paciente.email
            else
                if ok
                    p Paciente no registrado.
                else 
                    p     
          .tab-pane.fade#profile-tab-pane(role="tabpanel", aria-labelledby="profile-tab", tabindex="0")
            form.form(action="/pacientes?_method=put", method="post" ,name="formE" novalidate)
                .form-group
                    label(for="nombreE") Nombre:
                    input(type="text", name="nombreE", id="nombreE", class="form-control", required)
                    div.invalid-feedback Este campo es obligatorio.
                .form-group
                    label(for="apellidoE") Apellido:  
                    input(type="text", name="apellidoE", id="apellidoE", class="form-control", required)
                    div.invalid-feedback Este campo es obligatorio.
                .form-group
                    label(for="documentoE") Documento:
                    input(type="text", name="documentoE", id="documentoE", class="form-control", required)
                    div.invalid-feedback Este campo es obligatorio.
                .form-group
                    label(for="fechaNacimientoE") Fecha de Nacimiento:
                    input(type="date", name="fechaNacimientoE", id="fechaNacimientoE", class="form-control",  required, max=`${new Date().toISOString().split('T')[0]}`)
                    div.invalid-feedback Este campo es obligatorio y debe ser una fecha válida.
                .form-group
                  label(for="generoE") Género:
                  select(name="generoE", id="generoE", class="form-control", required)
                      option(value="") -- Seleccione una opción --
                      option(value="Masculino") Masculino
                      option(value="Femenino") Femenino
                      option(value="Otro") Otro
                .form-group
                    label(for="embarazadaESi") Sí
                    input(type="radio", name="embarazada",value="si", id="embarazadaESi")
                    label(for="embarazadaENo") No
                    input(type="radio", name="embarazadaE",value="no", id="embarazadaENo")
                .form-group
                    label(for="telefonoE") Teléfono:
                    input(type="tel", name="telefonoE", id="telefonoE", class="form-control", required)
                    div.invalid-feedback Este campo es obligatorio.
                .form-group
                    label(for="direccionE") Dirección:
                    input(type="text", name="direccionE", id="direccionE", class="form-control", required)
                    div.invalid-feedback Este campo es obligatorio.
                .form-group
                    label(for="emailE") Email:
                    input(type="emailE", name="emailE", id="emailE", class="form-control", required)
                    div.invalid-feedback Este campo es obligatorio.
                .form-group
                    label(for="rolE") Rol:
                    input(type="text", name="rolE", id="rolE", class="form-control", required, readonly, value="Paciente")
                .text-center
                    button(type="submit", class="btn btn-primary") Enviar
          .tab-pane.fade#contact-tab-pane(role="tabpanel", aria-labelledby="contact-tab", tabindex="0") //contacto
          .tab-pane.fade#disabled-tab-pane(role="tabpanel", aria-labelledby="disabled-tab", tabindex="0") 
           form(action="/users", method="post" name="form2" novalidate)
              .form-group
                  label(for="nombre") Nombre:
                  input(type="text", name="nombre", id="nombre", class="form-control", required)
                  div.invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="apellido") Apellido:
                  input(type="text", name="apellido", id="apellido", class="form-control", required)
                  div.invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="documento") Documento:
                  input(type="text", name="documento", id="documento", class="form-control", required)
                  div.invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="fechaNacimiento") Fecha de Nacimiento:
                  input(type="date", name="fechaNacimiento", id="fechaNacimiento", class="form-control", required)
                  div.invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="genero") Género:
                  select(name="genero", id="genero", class="form-control", required)
                      option(value="") -- Seleccione una opción --
                      option(value="Masculino") Masculino
                      option(value="Femenino") Femenino
                      option(value="Otro") Otro
                  .invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="embarazada") ¿Está embarazada?
                  #embarazadaDiv
                      label(for="embarazadaSi") Sí
                      input(type="radio", name="embarazada", value="1", id="embarazadaSi")
                      label(for="embarazadaNo") No
                      input(type="radio", name="embarazada", value="0", id="embarazadaNo", required)
                      .invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="telefono") Teléfono:
                  input(type="tel", name="telefono", id="telefono", class="form-control", required)
                  .invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="direccion") Dirección:
                  input(type="text", name="direccion", id="direccion", class="form-control", required)
                  .invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="email") Email:
                  input(type="email", name="email", id="email", class="form-control", required)
                  .invalid-feedback Este campo es obligatorio.
              .form-group
                  label(for="rol") Rol:
                  input(type="text", name="rol", id="rol", class="form-control", required, readonly, value="Paciente")
              .text-center
                  button(type="submit", class="btn btn-primary") Enviar
    script.
       let pacienteEditar=null; 
       const pacient = !{JSON.stringify(pacientes)};;
       let ok="#{ok}";
       ok=(ok==="true")
       const tabEditar = document.getElementById('profile-tab');
       const noRadio = document.getElementById("no");
       const siRadio = document.getElementById("si");
       const searchInput = document.getElementById("searchInput");
       searchInput.addEventListener("input", () => {
              const searchTerm = searchInput.value;
              formu.action = "/pacientes/" + searchTerm;
            });
       const disabled = document.getElementById("disabled-tab");
       if(ok && pacient.length===0){
              disabled.removeAttribute("disabled");}
       if(siRadio){
             siRadio.addEventListener("click", () => {
               if (siRadio.checked) {
                 disabled.setAttribute("disabled", "disabled");
               }
             });
             noRadio.addEventListener("click", () => {
                 if (noRadio.checked) {
                   disabled.removeAttribute("disabled");
                 }
               });
               
             
            }
       form2.addEventListener('submit',(e)=>{
         if(!form2.checkValidity()){
          e.preventDefault();
         }
         form2.classList.add('was-validated');
       },false)

       formE.addEventListener('submit',(e)=>{
         if(!formE.checkValidity()){
          e.preventDefault();
         }
         formE.classList.add('was-validated');
       },false)

       //  aca verifica que sea una fecha menor   ------------------------
     
    
       //------------------------------------------
       const filas = document.querySelectorAll('.fila');
       if(filas){
          filas.forEach( (fila)=> { fila.addEventListener('click', (e)=> {console.log(pacient)
                                                                         const [,index] = e.target.parentElement.id.split('-');
                                                                        pacienteEditar=pacient[Number(index)];
                                                                        console.log({pacienteEditar})
                                                                        console.log({index})
                                                                        document.getElementById("nombreE").value = pacienteEditar.nombre;
                                                                        document.getElementById("apellidoE").value = pacienteEditar.apellido;
                                                                        document.getElementById("documentoE").value = pacienteEditar.documento;
                                                                        document.getElementById("fechaNacimientoE").value = pacienteEditar.fechaNacimiento;
                                                                        const campoGenero=document.getElementById("generoE");
                                                                        for (let i = 0; i < campoGenero.options.length; i++) {
                                                                            if (campoGenero.options[i].value === pacienteEditar.genero) {
                                                                              campoGenero.selectedIndex = i;
                                                                              break;
                                                                            }
                                                                        }
                                                                        document.getElementById("telefonoE").value = pacienteEditar.telefono;
                                                                        document.getElementById("direccionE").value = pacienteEditar.direccion;
                                                                        document.getElementById("emailE").value = pacienteEditar.email;
                                                                        if (pacienteEditar.embarazada === "si") 
                                                                                 document.getElementById("embarazadaESi").checked = true;
                                                                        else 
                                                                              document.getElementById("embarazadaENo").checked = true;
                                                                               
                                                                        tabEditar.click();
                                                                       }
                                                         )
                                  }
                      )
        }
        const modal=("#{modal}"==="true")
        if(modal){
        const miModal = new bootstrap.Modal(document.getElementById('miModal'));
        miModal.show();}

        const modale=("#{modale}"==="true")
       
        if(modale){
           console.log(modale+"-------------");
        const miModale = new bootstrap.Modal(document.getElementById('miModale'));
        miModale.show();}


